# å‡ºç§Ÿè½¦å¸æœºå¼‚å¸¸è¡Œä¸ºæ£€æµ‹ç³»ç»Ÿ

åŸºäºå›¾ç¥ç»ç½‘ç»œçš„å‡ºç§Ÿè½¦å¸æœºå¼‚å¸¸é©¾é©¶æ¨¡å¼æ£€æµ‹ç³»ç»Ÿï¼Œä½¿ç”¨GPSè½¨è¿¹æ•°æ®å’ŒPOIä¿¡æ¯è¿›è¡Œæ™ºèƒ½åˆ†æã€‚

## ğŸš€ åŠŸèƒ½ç‰¹ç‚¹

- **å›¾æ³¨æ„åŠ›ç½‘ç»œï¼ˆGATï¼‰** è¿›è¡Œå¼‚å¸¸æ£€æµ‹
- **å¤šç±»åˆ«å¸æœºå»ºæ¨¡** åŸºäºèˆ’é€‚åŒºåŸŸåˆ†æ
- **POIç‰¹å¾èåˆ** å¢å¼ºç©ºé—´ç†è§£èƒ½åŠ›
- **ç¨€ç–å›¾å¤„ç†** æé«˜è®¡ç®—æ•ˆç‡
- **ç½‘æ ¼åŒ–ç©ºé—´åˆ†æ** æ”¯æŒå¯é…ç½®ç²’åº¦
- **å¤šç§æŸå¤±å‡½æ•°** ï¼ˆFocal Lossã€F1 Lossã€Precision Lossï¼‰
- **æ•°æ®å¢å¼º** å’Œç¼“å­˜æœºåˆ¶

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python 3.8+
- PyTorch 1.9+
- PyTorch Geometric
- NumPy, Pandas, Scikit-learn
- Matplotlib, Folium (ç”¨äºå¯è§†åŒ–)
- SciPy

## ğŸ› ï¸ å®‰è£…æŒ‡å—

1. å…‹éš†ä»“åº“ï¼š
```bash
git clone https://github.com/yourusername/taxi-anomaly-detection.git
cd taxi-anomaly-detection
```

2. å®‰è£…ä¾èµ–ï¼š
```bash
pip install -r requirements.txt
```

3. è®¾ç½®æ•°æ®ç›®å½•ï¼š
```bash
mkdir -p data/model data/similarity_matrix data/augmented_data_v2
```

## ğŸ“Š æ•°æ®æ ¼å¼

### è¾“å…¥æ•°æ®è¦æ±‚

1. **POIæ•°æ®** (`poi_path`):
   - æ ¼å¼ï¼šåŒ…å«POIä¿¡æ¯çš„æ–‡æœ¬æ–‡ä»¶
   - åˆ—ï¼šç«™ç‚¹åæ ‡ã€POIç±»å‹å’Œæ•°é‡
   - ç¤ºä¾‹ï¼š`examine_neighbor_poi_anomaly_detect_chengdu_in_500_1101.txt`

2. **å¸æœºè®¢å•æ•°æ®** (`driver_order_path`):
   - æ ¼å¼ï¼šåŒ…å«å¸æœºè½¨è¿¹çš„CSVæ–‡ä»¶
   - åˆ—ï¼šå¸æœºIDã€è®¢å•IDã€ä¸Šä¸‹è½¦åæ ‡å’Œæ—¶é—´æˆ³
   - ç¤ºä¾‹ï¼š`order_driver_01.txt`

3. **çœŸå®æ ‡ç­¾** (`ground_truth_path`):
   - æ ¼å¼ï¼šåŒ…å«æ ‡è®°å¼‚å¸¸ä½ç½®çš„Excelæ–‡ä»¶
   - åˆ—ï¼šåæ ‡å’Œæ ‡ç­¾
   - ç¤ºä¾‹ï¼š`ground_truth.xlsx`

### æ•°æ®ç»“æ„
```
data/
â”œâ”€â”€ model/                    # è®­ç»ƒå¥½çš„æ¨¡å‹
â”œâ”€â”€ similarity_matrix/        # å¸æœºç›¸ä¼¼åº¦çŸ©é˜µ
â”œâ”€â”€ augmented_data_v2/        # å¢å¼ºçš„å¸æœºæ•°æ®
â””â”€â”€ cluster_data_cache_v2.pkl # ç¼“å­˜çš„èšç±»æ•°æ®
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```python
from data_processing import data_prepare
from train import train

# å‡†å¤‡æ•°æ®
poi_path = 'path/to/poi_data.txt'
driver_order_path = 'path/to/driver_orders.txt'
ground_truth_path = 'path/to/ground_truth.xlsx'
grid_granularity = 500

# åŠ è½½å’Œå¤„ç†æ•°æ®
features_by_cluster, adjs_by_cluster, labels_by_cluster, driver_clusters, cluster_boundaries = data_prepare(
    poi_path, driver_order_path, ground_truth_path, grid_granularity
)

# è®­ç»ƒæ¨¡å‹
model, cluster_data = train(features_by_cluster, adjs_by_cluster, labels_by_cluster)
```

### é«˜çº§ä½¿ç”¨

```python
# ç½‘æ ¼å‹ç¼©ä»¥æé«˜æ•ˆç‡
from main import compress_grid_data

# å°†ç½‘æ ¼æ•°æ®å‹ç¼©åˆ°æ›´å°åŒºåŸŸ
compressed_features = compress_grid_data(features_by_cluster)
compressed_labels = compress_grid_data(labels_by_cluster)

# ä½¿ç”¨å‹ç¼©æ•°æ®è®­ç»ƒ
model, cluster_data = train(compressed_features, adjs_by_cluster, compressed_labels)
```

## ğŸ“ˆ æ¨¡å‹æ¶æ„

### ç¨€ç–å›¾æ³¨æ„åŠ›ç½‘ç»œï¼ˆSparseGATï¼‰

- **è¾“å…¥**ï¼šèŠ‚ç‚¹ç‰¹å¾ï¼ˆPOI + å¸æœºè½¨è¿¹ç‰¹å¾ï¼‰
- **å›¾ç»“æ„**ï¼šç©ºé—´é‚»æ¥ + å¸æœºè½¨è¿¹è¿æ¥
- **æ³¨æ„åŠ›æœºåˆ¶**ï¼šå¤šå¤´æ³¨æ„åŠ›è¿›è¡Œé‚»å±…èšåˆ
- **è¾“å‡º**ï¼šäºŒåˆ†ç±»ï¼ˆå¼‚å¸¸/æ­£å¸¸ï¼‰

### æ ¸å¿ƒç»„ä»¶

1. **SparseGraphAttentionLayer**ï¼šæ ¸å¿ƒæ³¨æ„åŠ›æœºåˆ¶
2. **å¤šå¤´æ³¨æ„åŠ›**ï¼š8ä¸ªæ³¨æ„åŠ›å¤´è¿›è¡Œé²æ£’ç‰¹å¾å­¦ä¹ 
3. **Dropoutæ­£åˆ™åŒ–**ï¼š0.2çš„dropoutç‡
4. **LeakyReLUæ¿€æ´»**ï¼šÎ±=0.2çš„è´Ÿæ–œç‡

## ğŸ”§ é…ç½®è¯´æ˜

### æ¨¡å‹å‚æ•°

```python
# æ¨¡å‹è¶…å‚æ•°
hidden_dim = 16          # éšè—å±‚ç»´åº¦
dropout = 0.2           # Dropoutç‡
alpha = 0.2             # LeakyReLUè´Ÿæ–œç‡
nheads = 8              # æ³¨æ„åŠ›å¤´æ•°é‡
lr = 5e-4              # å­¦ä¹ ç‡
weight_decay = 5e-4     # æƒé‡è¡°å‡
epochs = 10000         # è®­ç»ƒè½®æ•°
```

### ç½‘æ ¼é…ç½®

```python
# ç½‘æ ¼è¾¹ç•Œï¼ˆæ ¹æ®ä½ çš„æ•°æ®è°ƒæ•´ï¼‰
poi_boundary = [-28, -75, 73, 29]  # [min_x, min_y, max_x, max_y]
grid_granularity = 500             # ç½‘æ ¼å¤§å°ï¼ˆç±³ï¼‰
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

ç³»ç»Ÿä½¿ç”¨ä»¥ä¸‹æŒ‡æ ‡è¯„ä¼°æ€§èƒ½ï¼š

- **å‡†ç¡®ç‡**ï¼šæ•´ä½“åˆ†ç±»å‡†ç¡®ç‡
- **F1åˆ†æ•°**ï¼šç²¾ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡æ•°
- **ç²¾ç¡®ç‡**ï¼šçœŸæ­£ä¾‹ / (çœŸæ­£ä¾‹ + å‡æ­£ä¾‹)
- **å¬å›ç‡**ï¼šçœŸæ­£ä¾‹ / (çœŸæ­£ä¾‹ + å‡è´Ÿä¾‹)

### ç¤ºä¾‹ç»“æœ
```
é˜ˆå€¼: 0.5000, å¹³å‡æµ‹è¯•å‡†ç¡®ç‡: 0.8542, 
å¹³å‡F1: 0.7234, å¹³å‡ç²¾ç¡®ç‡: 0.6891, å¹³å‡å¬å›ç‡: 0.7612
```

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ data_processing.py      # æ•°æ®åŠ è½½å’Œé¢„å¤„ç†
â”œâ”€â”€ model.py               # SparseGATæ¨¡å‹å®šä¹‰
â”œâ”€â”€ train.py                # è®­ç»ƒå’Œè¯„ä¼°
â”œâ”€â”€ main.py                 # ä¸»æ‰§è¡Œè„šæœ¬
â”œâ”€â”€ gps_analysis.py         # GPSè½¨è¿¹åˆ†æ
â”œâ”€â”€ utils.py                # å·¥å…·å‡½æ•°
â”œâ”€â”€ preprocess.py           # æ•°æ®é¢„å¤„ç†å·¥å…·
â”œâ”€â”€ test_advanced.py        # é«˜çº§æµ‹è¯•
â”œâ”€â”€ example_multi_cluster.py # å¤šèšç±»ç¤ºä¾‹
â”œâ”€â”€ config.py               # é…ç½®æ–‡ä»¶
â”œâ”€â”€ examples/               # ä½¿ç”¨ç¤ºä¾‹
â”‚   â”œâ”€â”€ basic_usage.py      # åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹
â”‚   â”œâ”€â”€ advanced_usage.py   # é«˜çº§ä½¿ç”¨ç¤ºä¾‹
â”‚   â””â”€â”€ visualization_example.py # å¯è§†åŒ–ç¤ºä¾‹
â”œâ”€â”€ data/                   # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ model/             # æ¨¡å‹æ–‡ä»¶
â”‚   â”œâ”€â”€ similarity_matrix/ # ç›¸ä¼¼åº¦çŸ©é˜µ
â”‚   â””â”€â”€ augmented_data_v2/ # å¢å¼ºæ•°æ®
â””â”€â”€ README_CN.md           # ä¸­æ–‡è¯´æ˜æ–‡æ¡£
```

## ğŸ”¬ ç ”ç©¶åº”ç”¨

æœ¬ç³»ç»Ÿå¯ç”¨äºï¼š

- **äº¤é€šç®¡ç†**ï¼šç›‘æ§å‡ºç§Ÿè½¦å¸æœºè¡Œä¸ºæ¨¡å¼
- **å¼‚å¸¸æ£€æµ‹**ï¼šè¯†åˆ«å¼‚å¸¸é©¾é©¶æ¨¡å¼
- **åŸå¸‚è§„åˆ’**ï¼šç†è§£åŸå¸‚äº¤é€šæµ
- **æ”¿ç­–åˆ¶å®š**ï¼šæ•°æ®é©±åŠ¨çš„äº¤é€šæ”¿ç­–


## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **CUDAå†…å­˜ä¸è¶³**ï¼šå‡å°‘æ‰¹æ¬¡å¤§å°æˆ–ä½¿ç”¨CPU
2. **æ•°æ®æ ¼å¼é”™è¯¯**ï¼šæ£€æŸ¥è¾“å…¥æ•°æ®æ ¼å¼å’Œç¼–ç 
3. **ç¼ºå°‘ä¾èµ–**ï¼šä»requirements.txtå®‰è£…æ‰€æœ‰ä¾èµ–

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

- åœ¨å¯ç”¨æ—¶ä½¿ç”¨GPUåŠ é€Ÿ
- ä¸ºé‡å¤è¿è¡Œå¯ç”¨æ•°æ®ç¼“å­˜
- å¯¹å¤§è§„æ¨¡åˆ†æä½¿ç”¨ç½‘æ ¼æ•°æ®å‹ç¼©

## ğŸ”„ æ›´æ–°æ—¥å¿—

### ç‰ˆæœ¬ 1.0.0
- åˆå§‹å‘å¸ƒ
- SparseGATå®ç°
- å¤šç±»åˆ«å¸æœºå»ºæ¨¡
- POIç‰¹å¾èåˆ
- åŸºäºç½‘æ ¼çš„ç©ºé—´åˆ†æ

---

**æ³¨æ„**ï¼šæœ¬ç³»ç»Ÿè®¾è®¡ç”¨äºç ”ç©¶ç›®çš„ã€‚ä½¿ç”¨çœŸå®ä¸–ç•Œæ•°æ®æ—¶ï¼Œè¯·ç¡®ä¿ç¬¦åˆå½“åœ°æ•°æ®éšç§æ³•è§„ã€‚
